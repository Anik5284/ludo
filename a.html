<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ludo — Circular Board</title>
<style>
  body {
    font-family: system-ui,Segoe UI,Roboto,Arial;
    margin: 18px;
    background: #f6f7fb;
  }
  h1 { font-size: 20px; margin: 0 0 8px; }
  .wrap { display: flex; gap: 18px; }
  .board {
    position: relative;
    width: 500px;
    height: 500px;
    background: #fff;
    border-radius: 50%;
    margin: auto;
    box-shadow: 0 6px 18px rgba(0,0,0,.06);
  }
  .cell {
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    background: #e9eef8;
  }
  .piece {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 700;
  }
  .p0 { background: #e63946; }
  .p1 { background: #2a9d8f; }
  .p2 { background: #f4a261; }
  .p3 { background: #264653; }
  .controls { min-width: 220px; }
  button {
    padding: 8px 10px;
    border-radius: 6px;
    border: 0;
    background: #2b6df6;
    color: #fff;
    cursor: pointer;
  }
  .log {
    height: 320px;
    overflow: auto;
    background: #fff;
    padding: 8px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,.04);
  }
  .player-turn { font-weight: 700; margin: 8px 0; }
</style>
</head>
<body>
<h1>Ludo (Circular Board)</h1>
<div class="wrap">
  <div>
    <div class="board" id="board"></div>
  </div>
  <div class="controls">
    <div class="player-turn" id="turn">Turn: —</div>
    <div style="margin-bottom:8px">
      <button id="roll">Roll dice</button>
      <span id="dice" style="margin-left:10px;font-weight:700">—</span>
    </div>
    <div id="pieces-area"></div>
    <h3 style="margin-top:12px">Game log</h3>
    <div class="log" id="log"></div>
  </div>
</div>

<script>
const PLAYERS = 4;
const TOKENS_PER_PLAYER = 4;
const MAIN_TRACK = 52;
const FINISH_STEPS = 6;
const startIndex = [0, 13, 26, 39];

const state = {
  tokens: Array.from({length: PLAYERS}, ()=> Array.from({length: TOKENS_PER_PLAYER}, ()=> -1)),
  currentPlayer: 0,
  dice: null,
  finished: Array(PLAYERS).fill(false),
};

const boardEl = document.getElementById('board');
const logEl = document.getElementById('log');
const turnEl = document.getElementById('turn');
const diceEl = document.getElementById('dice');
const rollBtn = document.getElementById('roll');
const piecesArea = document.getElementById('pieces-area');

function log(msg) {
  const li = document.createElement('div');
  li.textContent = msg;
  logEl.prepend(li);
}

// Build circular board
const cells = [];
const centerX = 250;
const centerY = 250;
const radius = 200;
boardEl.innerHTML = '';
for (let i = 0; i < 52; i++) {
  const angle = (i / 52) * 2 * Math.PI;
  const c = document.createElement('div');
  c.className = 'cell';
  c.dataset.index = i;
  c.textContent = i;
  const x = centerX + radius * Math.cos(angle) - 20;
  const y = centerY + radius * Math.sin(angle) - 20;
  c.style.left = `${x}px`;
  c.style.top = `${y}px`;
  boardEl.appendChild(c);
  cells.push(c);
}

function render() {
  cells.forEach(c => { c.innerHTML = c.dataset.index; });

  while(piecesArea.firstChild) piecesArea.removeChild(piecesArea.firstChild);
  for (let p = 0; p < PLAYERS; p++) {
    const host = document.createElement('div');
    host.style.marginTop = '6px';
    host.innerHTML = `<strong>Player ${p+1}</strong> `;
    piecesArea.appendChild(host);
    for (let t = 0; t < TOKENS_PER_PLAYER; t++) {
      const pos = state.tokens[p][t];
      const tokenEl = document.createElement('div');
      tokenEl.className = 'piece p'+p;
      tokenEl.textContent = String(t+1);
      tokenEl.dataset.player = p;
      tokenEl.dataset.token = t;
      tokenEl.style.cursor = 'pointer';
      tokenEl.addEventListener('click', ()=> tryMoveToken(p, t));
      if (pos === -1) {
        tokenEl.style.margin = '4px';
        host.appendChild(tokenEl);
      } else {
        cells[pos].appendChild(tokenEl);
      }
    }
  }
  turnEl.textContent = `Turn: Player ${state.currentPlayer+1}`;
  diceEl.textContent = state.dice===null ? '—' : state.dice;
}

function rollDice() {
  const v = Math.floor(Math.random()*6) + 1;
  state.dice = v;
  log(`Player ${state.currentPlayer+1} rolled ${v}`);
  render();
  return v;
}

rollBtn.addEventListener('click', () => {
  if (state.finished[state.currentPlayer]) { nextPlayer(); return; }
  const v = rollDice();
  const legal = hasLegalMove(state.currentPlayer, v);
  if (!legal) {
    log(`No legal moves for Player ${state.currentPlayer+1}`);
    state.dice = null;
    setTimeout(nextPlayer, 800);
  } else {
    const legalTokens = legalTokensList(state.currentPlayer, v);
    if (legalTokens.length === 1) setTimeout(()=> tryMoveToken(state.currentPlayer, legalTokens[0]), 600);
  }
});

function hasLegalMove(player, dice) {
  return state.tokens[player].some((pos, idx)=> canMove(player, idx, dice));
}
function legalTokensList(player, dice) {
  return state.tokens[player].map((pos,idx)=> canMove(player,idx,dice) ? idx : null).filter(x=>x!==null);
}

function canMove(player, tokenIdx, dice) {
  const pos = state.tokens[player][tokenIdx];
  if (pos === -1) return dice === 6;
  if (pos >= 100) return false; // finish handling omitted for brevity
  return true;
}

function tryMoveToken(player, tokenIdx) {
  if (player !== state.currentPlayer || state.dice === null) return;
  if (!canMove(player, tokenIdx, state.dice)) return;
  moveToken(player, tokenIdx, state.dice);
  state.dice = null;
  nextPlayer();
}

function moveToken(player, tokenIdx, dice) {
  let pos = state.tokens[player][tokenIdx];
  if (pos === -1) {
    state.tokens[player][tokenIdx] = startIndex[player];
  } else {
    state.tokens[player][tokenIdx] = (pos + dice) % MAIN_TRACK;
  }
}

function nextPlayer() {
  state.currentPlayer = (state.currentPlayer + 1) % PLAYERS;
  render();
}

render();
log('Game ready. Click "Roll dice" to start.');
</script>
</body>
</html>
